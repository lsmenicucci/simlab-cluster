# Define a new storage pool and activate it
- name: Define a storage pool
  virt_pool:
    state: active
    name: "vcluster-{{ vcluster_tag }}"
    xml: '{{ lookup("template", "../templates/storage.xml.j2") }}'
    autostart: true

- name: Get pool facts
  virt_pool:
    command: facts

- name: Debug
  debug:
    msg: "{{ ansible_libvirt_pools[pool_name].volumes }}"
  vars:
    pool_name: "vcluster-{{ vcluster_tag }}"

- name: Create head volume
  command: "virsh vol-create {{ pool_name }} head"
  vars:
    pool_name: "vcluster-{{ vcluster_tag }}"